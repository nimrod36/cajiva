#!/bin/bash
# Pre-commit hook: Run tests and linting before commit
# Skip with: SKIP_HOOKS=1 git commit

# Check if hooks should be skipped
if [ "$SKIP_HOOKS" = "1" ] || [ "$NO_VERIFY" = "1" ]; then
  echo "‚ö†Ô∏è  Skipping pre-commit checks (SKIP_HOOKS=1)"
  exit 0
fi

echo "üîç Running pre-commit checks..."
echo "(Skip with: SKIP_HOOKS=1 git commit or git commit --no-verify)"
echo ""

# Run RSpec tests
echo "Running RSpec tests..."
bundle exec rspec
if [ $? -ne 0 ]; then
  echo "‚ùå RSpec tests failed! Commit aborted."
  exit 1
fi

# Run Cucumber tests
echo ""
echo "Running Cucumber tests..."
bundle exec cucumber specs/
if [ $? -ne 0 ]; then
  echo "‚ùå Cucumber tests failed! Commit aborted."
  exit 1
fi

# Run RuboCop linting
echo ""
echo "Running linter..."
bundle exec rubocop
if [ $? -ne 0 ]; then
  echo "‚ùå Linting failed! Commit aborted."
  exit 1
fi

echo ""
echo "‚úÖ All pre-commit checks passed!"
exit 0
